"use strict";(self.webpackChunklasa_schedules=self.webpackChunklasa_schedules||[]).push([[7246],{5503:function(e,t,s){s.d(t,{D:function(){return n}});var r=s(8583),i=s(639);let n=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i.oAB({type:e}),e.\u0275inj=i.cJS({imports:[[r.ez]]}),e})()},6421:function(e,t,s){s.d(t,{F:function(){return h}});var r=s(2340),i=s(639),n=s(1841),u=s(6370);let h=(()=>{class e{constructor(e,t){this.http=e,this.state=t,this.SCHEDULES_API=r.N.schedulesAPI}getSchedules(){return this.http.get(this.SCHEDULES_API+"/schedule.json")}getSchoolYear(){return this.http.get(this.SCHEDULES_API+"/school-year.json")}determineSchedule(e,t,s){e=this.stripTime(e);let r=!1,i={currentSchedule:null};if(e<new Date(t.not_before)||e>new Date(t.not_after))return i.scheduleReason="School not in session",e>new Date(t.not_after)?(i.statusCode=-1,i):(i.statusCode=0,i);if(t.holidays.forEach(t=>{this.dateApplies(e,t)&&(i.scheduleReason="School Holiday",r=!0)}),r)return i.statusCode=0,i;for(let n=0;n<s.length;n++)if("dates"in s[n]&&s[n].dates.forEach(t=>{this.dateApplies(e,t)&&(i.currentSchedule=n,r=!0)}),r)return i.statusCode=3,i;for(let n=0;n<s.length;n++)if("applyDay"in s[n]&&s[n].applyDay.includes(e.getDay()))return i.currentSchedule=n,i.statusCode=2,i;return 6==e.getDay()||0==e.getDay()?(i.currentSchedule=null,i.scheduleReason="Weekend",i.statusCode=0,i):(i.currentSchedule=0,i.statusCode=1,i)}dateApplies(e,t){return t instanceof Array?e>=new Date(t[0])&&e<=new Date(t[1]):e.getTime()===new Date(t).getTime()}stripTime(e){return(e=new Date(e.getTime())).setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}subtractTime(e,t){let s=e.split(":"),r=t.split(":"),i=3600*Number(s[0])+60*Number(s[1])+Number(s[2])-(3600*Number(r[0])+60*Number(r[1])+Number(r[2])),n=[Math.floor(i/3600),Math.floor(i%3600/60),i%60],u=[];return n.forEach(e=>{let t=e.toString();u.push(t.length<2?"0"+t:t)}),u[0]+":"+u[1]+":"+u[2]}addTime(e,t){let s=e.split(":"),r=t.split(":"),i=3600*Number(s[0])+60*Number(s[1])+Number(s[2])+(3600*Number(r[0])+60*Number(r[1])+Number(r[2])),n=[Math.floor(i/3600),Math.floor(i%3600/60),i%60],u=[];return n.forEach(e=>{let t=e.toString();u.push(t.length<2?"0"+t:t)}),u[0]+":"+u[1]+":"+u[2]}periodCheck(e,t,s){let r=e.toLocaleTimeString([],{hour12:!1}),i=this.determineSchedule(e,t,s);if(this.state.setCurrentSchedule(s[i.currentSchedule]),null==i.currentSchedule)return{currentPeriod:i.scheduleReason};let n=s[i.currentSchedule].combinedAB||!1;for(let u=0;u<s[i.currentSchedule].schedule.length;u++){let t=s[i.currentSchedule].schedule[u],h=(4===t.startTime.length?"0":"")+t.startTime+":00",c=(4===t.endTime.length?"0":"")+t.endTime+":00";if(r<h&&0==u)return{currentPeriod:"School not started.",timeRemaining:this.subtractTime(h,r)};let l,o=s[i.currentSchedule].schedule[u+1]?s[i.currentSchedule].schedule[u+1]:null,a=t.name;if(n&&-1!=a.indexOf("/")&&(1===e.getDay()||3===e.getDay()?a=t.name.substring(0,1):(2===e.getDay()||4===e.getDay())&&(a=t.name.substring(2))),null!=o&&(l=o.name,n&&-1!=l.indexOf("/")&&(1===e.getDay()||3===e.getDay()?l=o.name.substring(0,1):(2===e.getDay()||4===e.getDay())&&(l=o.name.substring(2)))),r<c&&r>=h)return{currentPeriod:a,periodEndTime:c,timeRemaining:this.subtractTime(c+":00",r)};if(null!=o&&r>=c&&r<o.startTime)return{currentPeriod:"Between "+a+" and "+l,timeRemaining:this.subtractTime(o.startTime+":00",r)};if(null==o&&r>=c)return{currentPeriod:"School is released."}}}}return e.\u0275fac=function(t){return new(t||e)(i.LFG(n.eN),i.LFG(u.b))},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},6370:function(e,t,s){s.d(t,{b:function(){return _}});var r=s(4762),i=s(9765),n=s(5319);class u extends n.w{constructor(e,t){super()}schedule(e,t=0){return this}}class h extends u{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const s=this.id,r=this.scheduler;return null!=s&&(this.id=this.recycleAsyncId(r,s,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this}requestAsyncId(e,t,s=0){return setInterval(e.flush.bind(e,this),s)}recycleAsyncId(e,t,s=0){if(null!==s&&this.delay===s&&!1===this.pending)return t;clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const s=this._execute(e,t);if(s)return s;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let s,r=!1;try{this.work(e)}catch(i){r=!0,s=!!i&&i||new Error(i)}if(r)return this.unsubscribe(),s}_unsubscribe(){const e=this.id,t=this.scheduler,s=t.actions,r=s.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&s.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null}}let c=(()=>{class e{constructor(t,s=e.now){this.SchedulerAction=t,this.now=s}schedule(e,t=0,s){return new this.SchedulerAction(this,e).schedule(s,t)}}return e.now=()=>Date.now(),e})();class l extends c{constructor(e,t=c.now){super(e,()=>l.delegate&&l.delegate!==this?l.delegate.now():t()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(e,t=0,s){return l.delegate&&l.delegate!==this?l.delegate.schedule(e,t,s):super.schedule(e,t,s)}flush(e){const{actions:t}=this;if(this.active)return void t.push(e);let s;this.active=!0;do{if(s=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,s){for(;e=t.shift();)e.unsubscribe();throw s}}}const o=new class extends l{}(class extends h{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,s=0){return null!==s&&s>0||null===s&&this.delay>0?super.requestAsyncId(e,t,s):e.flush(this)}});var a=s(7393),d=s(9193),f=s(5917),p=s(7574);class m{constructor(e,t,s){this.kind=e,this.value=t,this.error=s,this.hasValue="N"===e}observe(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}}do(e,t,s){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return s&&s()}}accept(e,t,s){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,s)}toObservable(){switch(this.kind){case"N":return(0,f.of)(this.value);case"E":return e=this.error,new p.y(t=>t.error(e));case"C":return(0,d.c)()}var e;throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new m("N",e):m.undefinedValueNotification}static createError(e){return new m("E",void 0,e)}static createComplete(){return m.completeNotification}}m.completeNotification=new m("C"),m.undefinedValueNotification=new m("N",void 0);class g extends a.L{constructor(e,t,s=0){super(e),this.scheduler=t,this.delay=s}static dispatch(e){const{notification:t,destination:s}=e;t.observe(s),this.unsubscribe()}scheduleMessage(e){this.destination.add(this.scheduler.schedule(g.dispatch,this.delay,new w(e,this.destination)))}_next(e){this.scheduleMessage(m.createNext(e))}_error(e){this.scheduleMessage(m.createError(e)),this.unsubscribe()}_complete(){this.scheduleMessage(m.createComplete()),this.unsubscribe()}}class w{constructor(e,t){this.notification=e,this.destination=t}}var b=s(7971),S=s(8858);class E extends i.xQ{constructor(e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,s){super(),this.scheduler=s,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=e<1?1:e,this._windowTime=t<1?1:t,t===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(e){if(!this.isStopped){const t=this._events;t.push(e),t.length>this._bufferSize&&t.shift()}super.next(e)}nextTimeWindow(e){this.isStopped||(this._events.push(new y(this._getNow(),e)),this._trimBufferThenGetEvents()),super.next(e)}_subscribe(e){const t=this._infiniteTimeWindow,s=t?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=s.length;let u;if(this.closed)throw new b.N;if(this.isStopped||this.hasError?u=n.w.EMPTY:(this.observers.push(e),u=new S.W(this,e)),r&&e.add(e=new g(e,r)),t)for(let n=0;n<i&&!e.closed;n++)e.next(s[n]);else for(let n=0;n<i&&!e.closed;n++)e.next(s[n].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),u}_getNow(){return(this.scheduler||o).now()}_trimBufferThenGetEvents(){const e=this._getNow(),t=this._bufferSize,s=this._windowTime,r=this._events,i=r.length;let n=0;for(;n<i&&!(e-r[n].time<s);)n++;return i>t&&(n=Math.max(n,i-t)),n>0&&r.splice(0,n),r}}class y{constructor(e,t){this.time=e,this.value=t}}var v=s(6215),N=s(639),x=s(1628);let _=(()=>{class e{constructor(e){this.db=e,this.PREFERENCES_KEY="app-preferences",this.preferences=new v.X({twentyfour:!1,bells:!1}),this.currentSchedule=new E(1),this.initStorage(),e.get(this.PREFERENCES_KEY).then(t=>{t?this.preferences.next(t):e.set(this.PREFERENCES_KEY,this.preferences.getValue())})}initStorage(){return(0,r.mG)(this,void 0,void 0,function*(){yield this.db.create()})}getPreferences(){return this.preferences.asObservable()}setPreferences(e){this.db.set(this.PREFERENCES_KEY,this.preferences).then(()=>this.preferences.next(e))}setPreference(e,t){let s=this.preferences.getValue();s[e]=t,this.db.set(this.PREFERENCES_KEY,s).then(()=>this.preferences.next(s))}getCurrentSchedule(){return this.currentSchedule.asObservable()}setCurrentSchedule(e){this.currentSchedule.next(e)}}return e.\u0275fac=function(t){return new(t||e)(N.LFG(x.K))},e.\u0275prov=N.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},9775:function(e,t,s){s.d(t,{x:function(){return i}});var r=s(639);let i=(()=>{class e{transform(e,t){let s="";if(!t&&e){let t=e.indexOf(":"),r=Number(e.substring(0,t));return s+=String(r>12?r-12:r),s+=e.substring(t),s+=r>=12?"p":"a",s}return e}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=r.Yjl({name:"timeFormat",type:e,pure:!0}),e})()}}]);